<?xml version="1.0" encoding="utf-8"?>
<s:ItemRenderer xmlns:fx="http://ns.adobe.com/mxml/2009" 
				xmlns:s="library://ns.adobe.com/flex/spark" 
				xmlns:mx="library://ns.adobe.com/flex/mx" 
				autoDrawBackground="true"
				dataChange="itemrenderer1_dataChangeHandler(event)"
				rollOver="currentState='hover'"
				rollOut="currentState='default'" xmlns:components="components.*">
	<s:states>
		<s:State name="default"/>
		<s:State name="hover"/>
	</s:states>
	<fx:Script>
		<![CDATA[
			import classes.AppItem;
			import classes.UIController;
			
			import mx.collections.ArrayList;
			import mx.controls.Alert;
			import mx.events.CloseEvent;
			import mx.events.FlexEvent;
			import mx.utils.Base64Decoder;
			
			import spark.components.List;
			
			protected function itemrenderer1_dataChangeHandler(event:FlexEvent):void
			{
				if (data) {
					if (data.iconBase64) {
						var base64Dec:Base64Decoder = new Base64Decoder();
						base64Dec.decode(data.iconBase64);
						var byteArr:ByteArray = base64Dec.toByteArray();
						img.load(byteArr);
					}
					else {
						img.source = data.iconUrl;
					}
				}
			}
			
			protected function confirmHandler(event:CloseEvent):void {
				if (event.detail != Alert.YES)
					return;
				
				var list:List = this.owner as List;
				var index:int = list.dataGroup.getChildIndex(this);
				if (list.id == "lstAppOnDevice") {
					UIController.instance.removeAppOnDevice(data as AppItem);
				}
				else if (list.id == "lstAppOnPc") {
					UIController.instance.removeAppOnPc(data as AppItem);
				}
			}
			
			protected function btnInstall_clickHandler(event:MouseEvent):void
			{
				UIController.instance.installApp(data as AppItem);
			}
			
			protected function btnDelete_clickHandler(event:MouseEvent):void
			{
				Alert.show("确认删除吗？", "确认", Alert.YES|Alert.NO, null, confirmHandler, null, Alert.YES);
			}
		]]>
	</fx:Script>
	<s:HGroup verticalAlign="middle" gap="0"
			  paddingTop="5" paddingBottom="5"
			  width="300">
		<mx:Image id="img" width="120" height="160"/>
		<s:VGroup width="100%" height="100%">
			<s:Label text="{data.name}"/>
			<s:HGroup>
				<components:KPButton text="详情"/>
				<components:KPButton text="购买"/>
			</s:HGroup>
		</s:VGroup>
	</s:HGroup>
</s:ItemRenderer>